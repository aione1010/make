<!DOCTYPE html>
<html>

<head>
    <title>ife 28-30 </title>
    <meta charset="utf-8">
    <style>
        input{
            width:200px;
        }
        ul{
            cursor: default;
        }
        li:hover {
            background-color: aqua;
        }
        ul li{
            width:200px;
        }
        #selected{
            color:pink;
        }
    </style>
</head>

<body>
    <input id='email-input' type='text'>
    <ul id='email-sug-wrapper' class='email-sug'></ul>
    <script>
        var input = document.getElementById('email-input'),
            ul = document.getElementById('email-sug-wrapper');
        var postfixList = ['163.com', 'gmail.com', '126.com', 'qq.com', '263.net'];
        input.oninput = function (event) {
            var val = input.value;
            var value = getValue(val);
            var str = getHint(value);
            addToUl(str);
            controlUl(value);
        };
        function getValue(val) {  //获取输入内容;
            return val.trim();
        };
        function encodeHtml(str){     //编码
            var s='';
            if(str.length == 0){
                s='';
            }else{
                s = str.replace(/&/g,'&amp;');
                s=s.replace(/</g,'&lt;');
                s=s.replace(/>/g,'&gt;');
                s = s.replace(/\'/g,"'");
                s=s.replace(/\"/g,'"');
            }
            return s;
        };
        function decodeHtml(str){    //解码
            var s='';
            if(str.length == 0){
                s='';
            }else{
                s = str.replace(/&amp;/g,'&');
                s=s.replace(/&lt;/g,'<');
                s=s.replace(/&gt;/g,'>');
                s = s.replace(/'/g,"\'");
                s=s.replace(/"/g,'\"');
            }
            return s;
        };
        function getHint(va) {            //增加列表条目
            var s = '';
            var value = encodeHtml(va);
            if (value.length > 0) {
                if (value.indexOf('@') < 0) {
                    for (var i = 0; i < postfixList.length; i++) {
                        s += '<li>' + value + '@' + postfixList[i] + '</li>';
                    }
                } else if (value.indexOf('@') >= 0) {
                    var val = value.split('@')[0],
                        val2 = value.split('@')[1];
                    len = val2.length;
                    for (var i = 0; i < postfixList.length; i++) {
                        if (val2 == postfixList[i].slice(0, len)) {
                            s += '<li>' + val + '@' + postfixList[i] + '</li>';
                        }
                    }
                    if(s==''){
                        for(var i = 0; i < postfixList.length; i++){
                            s +='<li>' + val + '@' + postfixList[i] + '</li>';
                        }
                    }
                }
            }
            return s;
        };
        function addToUl(str) {             //添加到ul之中
            ul.innerHTML = str;
            ul.style.listStyleType = 'none';
            ul.style.padding = '0px';
        };
        function controlUl(val) {           //控制ul的显示与隐藏
            if (!val) {
                hidden();
            } else {
                show();
            }
        };
        function hidden() {               //ul隐藏
            ul.style.visibility = 'hidden';
        };
        function show() {                //ul显示
            ul.style.visibility = 'visible';
        };
        document.onclick = function(event){    //点击
            var li = document.getElementsByTagName('li');
            for(var i = 0,len = li.length;i<len;i++){
                if(event.target==li[i]){
                    // console.log(li[i].innerHTML);  这里，加入输入的是&，结果就是&amp；
                    input.value = decodeHtml(li[i].innerHTML);
                    hidden();
                }
            }
        };

        

    </script>
</body>

</html>
